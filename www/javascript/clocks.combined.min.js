function clocks_init(){clocks_load_clocks(clocks_draw_clocks);var a=document.getElementById("add");a&&a.addEventListener("click",clocks_create_clock,false)}function clocks_load_clocks(a){localforage.getItem("clocks",function(c){a(c)})}function clocks_remove_clock(a){clocks_load_clocks(function(c){delete c[a];clocks_save_clocks(c)})}function clocks_save_clocks(a){localforage.setItem("clocks",a,function(c){clocks_redraw_clocks(c)})}
function clocks_create_clock(){var a=prompt("Location:");if(!a)return false;var c=prompt("Offset (from UTC): ");if(!c)return false;clocks_add_clock(a,{offset:c})}function clocks_add_clock(a,c){clocks_load_clocks(function(b){b||(b={});b[a]=c;clocks_save_clocks(b)})}function clocks_purge_clocks(){for(var a=document.getElementsByClassName("clock");a[0];)a[0].parentNode.removeChild(a[0])}function clocks_redraw_clocks(a){clocks_purge_clocks();clocks_draw_clocks(a)}
function clocks_draw_clocks(a){a=clocks_sort_clocks(a);for(loc in a)clocks_draw_clock(loc,a[loc])}function clocks_sort_clocks(a){var c={};for(h in a){var b=parseInt(a[h].offset);c[b]||(c[b]=[]);c[b].push(h)}var d=Object.keys(c);d.sort(function(i,j){return i-j});var e={};for(var g in d){b=d[g];for(var f in c[b]){var h=c[b][f];e[h]=a[h]}}return e}
function clocks_draw_clock(a,c){var b=clocks_clock_id(a,c),d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("id",b);b=document.createElement("div");b.setAttribute("data-location",a);var e=[];e.push("clock");var g=clocks_stats(a,c);e.push("clock-"+g.tod);g.today||e.push(g.tomorrow?"clock-tomorrow":"clock-yesterday");b.setAttribute("class",e.join(" "));document.getElementById("clocks");b.appendChild(d);b.addEventListener("click",function(f){f=f.target;if(f.nodeName=="DIV"){f=
f.getAttribute("data-location");confirm("Remove this clock?")&&clocks_remove_clock(f)}},false);document.body.appendChild(b);clocks_start_clock(a,c)}function clocks_start_clock(a,c){var b=clocks_clock_id(a,c),d=(new Date).getTimezoneOffset()/60,e=parseInt(c.offset);(new Clock(b,d+e)).startClock()}function clocks_clock_id(a){a=a;a=a.toLowerCase();a=a.replace(/ /g,"-");return a="clock-"+a}
function clocks_stats(a,c){var b=(new Date).getTimezoneOffset()/60,d=parseInt(c.offset);b=clocks_get_dt(0-b);var e=clocks_get_dt(d);var g=d=null,f=null;if(clocks_dt_to_ymd(b)==clocks_dt_to_ymd(e))d=true;else if(e.getTime()>b.getTime())g=true;else f=true;b=e.getUTCHours()<12?"am":"pm";b={today:d,tomorrow:g,yesterday:f,tod:b};console.log(b);return b}function clocks_dt_to_ymd(a){return a.toISOString().split("T")[0]}
function clocks_get_dt(a){var c=new Date;a=a*60*60*1E3;var b=new Date;b.setTime(c.getTime()+a);return b};
